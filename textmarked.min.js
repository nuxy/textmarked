"use strict";function TextMarked(v,p){void 0===p&&(p={});var e=this,t={allowKeys:"a-z0-9\\s,.?!$%&()\\[\\]\"'-_#*`>",allowEnter:!1,clipboard:!1,showExample:!1},h={buttons:[],content:null,selection:null};function b(e){var t,n,r=null==(t=p)?void 0:t.allowKeys,a=e.key,o=e.target;return new RegExp("^["+r+"]{1}$","i").test(a)||"Backspace"===a||"Enter"===a&&null!=(n=p)&&n.allowEnter?L(o):e.preventDefault()}function g(e){var t=e.target;w(e),m(e),L(t)}function o(e){var t=e.target,n=h.selection;if(!n)return e.preventDefault();for(var r=n.nodes,a=n.start,o=n.end,i=n.value,s=r.length,d=r[0],l=r[s-1],c=!1,u=1,f=0;f<s;f++){var v=r[f],p=void 0;if(1<s){switch(t.dataset.id){case"Blockquote":p=M(v.data),c=!0;break;case"Ordered-List":p=D(v.data,u++),c=!0;break;case"Unordered-List":p=q(v.data),c=!0;break;default:p=v.data}v.textContent=p}else{switch(t.dataset.id){case"Heading":p=C(i);break;case"Bold":p=A(i);break;case"Italic":p=B(i);break;case"Blockquote":p=M(i);break;case"Ordered-List":p=D(i);break;case"Unordered-List":p=q(i);break;case"Code":p=N(i);break;case"Horizontal-Rule":p=O(i),c=!0;break;case"Link":p=R(i);break;case"Image":p=T(i)}a<o?v.textContent=y(v.textContent,a,o,p):0<o?v.after(p):v.textContent=p}}c&&(d.before(document.createElement("br")),l.after(document.createElement("br"))),L(),h.selection=null}function m(e){var t=window.getSelection(),n=t.focusNode,r=t.focusOffset,a=t.anchorNode,o=t.anchorOffset,i=o<r,s=i?o:r,d=i?r:o,l=i?a:n,c=i?n:a;if(!function(e){return e&&e.contentEditable}(l)){for(var u=h.content.childNodes,f=[],v=!1,p=0;p<u.length;p++){var b=u[p],g=r===o;"BR"===b.tagName||(b!==l||g||(v=!0),v&&f.push(b),b===c&&(v=!1))}s===d&&(1<d||0===s)||(h.selection={nodes:f.length?f:[l],start:s,end:d,value:t.toString()},w(e))}}function k(e){if(!p.clipboard)return e.preventDefault()}function x(e){e.preventDefault();var t=window.getSelection();if(p.clipboard&&t.rangeCount){for(var n=e.clipboardData.getData("text").split("\n"),r=0;r<n.length;r++){var a=document.createElement("div");a.innerText=n[r],t.getRangeAt(0).insertNode(a)}L()}}function w(e){for(var t=e.target,n=h.buttons,r=0;r<n.length;r++){var a=n[r];t.textContent?(a.classList.remove("disabled"),a.addEventListener("click",o)):(a.classList.add("disabled"),a.removeEventListener("click",o))}}function E(e){e.preventDefault()}function L(e){void 0===e&&(e=h.content),v.value=e.innerText}function y(e,t,n,r){void 0===e&&(e=""),void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r="");var a=e.split(""),o=n-t;return a.splice(t,o,r),a.join("")}function $(e){switch(e){case"Heading":return C(e);case"Bold":return A(e);case"Italic":return B(e);case"Blockquote":return M(e);case"Ordered-List":return D(e);case"Unordered-List":return q(e);case"Code":return N(e);case"Horizontal-Rule":return O();case"Link":return R();case"Image":return T()}}function C(e){return"# "+e}function A(e){return"**"+(e||" ")+"**"}function B(e){return"*"+(e||" ")+"*"}function M(e){return"> "+e}function D(e,t){return void 0===t&&(t=1),t+". "+e}function q(e){return"- "+e}function N(e){return"`"+(e||" ")+"`"}function O(e){return e||"---"}function R(e){return"["+(e||"title")+"](https://www.example.com)"}function T(e){return"!["+(e||"alt text")+"](image.jpg)"}return function(e){if(null==(e=p=Object.assign(t,p))||!e.options.length)throw new Error("Failed to initialize (missing settings)");v.form.addEventListener("reset",function(){h.content.textContent=""}),function(){var e,t=null==(e=p)?void 0:e.options.length,n=document.createElement("div");n.classList.add("textmarked");var r=v.getBoundingClientRect(),a=Math.round(r.height),o=Math.round(r.width);n.style.width=o+"px";var i=document.createElement("ul");i.classList.add("options"),i.setAttribute("aria-label","Markdown options"),i.setAttribute("role","menu");for(var s=Math.round((o-2*t)/t),d=0;d<t;d++){var l,c=p.options[d],u=document.createElement("li");u.classList.add("icon","disabled",c),u.setAttribute("aria-label",c),u.setAttribute("data-id",c),u.setAttribute("role","button"),u.setAttribute("tabindex",d+1),u.setAttribute("title",null!=(l=p)&&l.showExample?$(c):c),u.style.height=s+"px",u.style.width=s+"px",u.addEventListener("mousedown",E),i.appendChild(u),h.buttons.push(u)}n.appendChild(i);var f=document.createElement("div");f.classList.add("content"),f.setAttribute("contenteditable","true"),f.setAttribute("aria-label","Content editor"),f.setAttribute("role","textbox"),f.setAttribute("tabindex",t+1),f.innerText=v.value;f.style.minHeight=a-12+"px",f.style.minWidth=o-12+"px",f.addEventListener("focus",w),f.addEventListener("keydown",b),f.addEventListener("keyup",g),f.addEventListener("mouseup",m),f.addEventListener("copy",k),f.addEventListener("cut",k),f.addEventListener("paste",x),h.content=f,n.appendChild(f),v.parentNode.insertBefore(n,v),v.style.position="absolute",v.style.visibility="hidden"}()}(),e.focus=function(){h.content.focus()},e.markup=function(){return function(e){void 0===e&&(e="");for(var t=e.split(/\n/),n=[],r=0;r<t.length;r++){var a=t[r];n.push(a.replace(/^#\s(.*)$/g,"<h1>$1</h1>").replace(/\*\*(.*)\*\*/g,"<strong>$1</strong>").replace(/\*(.*)\*/g,"<em>$1</em>").replace(/^>\s(.*)$/g,"<blockquote>$1</blockquote>").replace(/`(.*)`/g,"<code>$1</code>").replace(/^---$/g,"<hr>").replace(/!\[([^()]+)\]\(([^()]+)\)/g,'<img src="$2" alt="$1">').replace(/\[([^()]+)\]\(([^()]+)\)/g,'<a href="$2">$1</a>'));var o=n[n.length-2];""===a&&/(h1|blockquote|hr)>$/.test(o)&&n.pop()}return n.join("<br />")}(v.value)},e}window.textMarked=function(e,t){return new TextMarked(e,t)},"undefined"!=typeof module&&module.exports&&(module.exports=TextMarked);