"use strict";function TextMarked(v,p){void 0===p&&(p={});var e=this,t={allowKeys:"a-z0-9\\s,.?!$%&()\\[\\]\"'-_#*`>",allowEnter:!1,clipboard:!1,showExample:!1},h={buttons:[],content:null,selection:null};function b(e){var t,n,r=null==(t=p)?void 0:t.allowKeys,a=e.key,i=e.target;return new RegExp("^["+r+"]{1}$","i").test(a)||"Backspace"===a||"Enter"===a&&null!=(n=p)&&n.allowEnter?L(i):e.preventDefault()}function g(e){var t=e.target;w(e),m(e),L(t)}function i(e){var t=e.target,n=h.selection;if(!n)return e.preventDefault();for(var r=n.nodes,a=n.start,i=n.end,o=n.value,s=r.length,u=r[0],d=r[s-1],l=!1,c=1,f=0;f<s;f++){var v=r[f],p=void 0;if(1<s){switch(t.dataset.id){case"Blockquote":p=M(v.data),l=!0;break;case"Ordered-List":p=D(v.data,c++),l=!0;break;case"Unordered-List":p=N(v.data),l=!0;break;default:p=v.data}v.textContent=p}else{switch(t.dataset.id){case"Heading":p=C(o);break;case"Bold":p=A(o);break;case"Italic":p=B(o);break;case"Blockquote":p=M(o);break;case"Ordered-List":p=D(o);break;case"Unordered-List":p=N(o);break;case"Code":p=O(o);break;case"Horizontal-Rule":p=R(o),l=!0;break;case"Link":p=T(o);break;case"Image":p=q(o)}a<i?v.textContent=$(v.textContent,a,i,p):0<i?v.after(p):v.textContent=p}}l&&(u.before(document.createElement("br")),d.after(document.createElement("br"))),L(),h.selection=null}function m(e){var t=window.getSelection(),n=t.focusNode,r=t.focusOffset,a=t.anchorNode,i=t.anchorOffset,o=i<r,s=o?i:r,u=o?r:i,d=o?a:n,l=o?n:a;if(!function(e){return e&&e.contentEditable}(d)){for(var c=h.content.childNodes,f=[],v=!1,p=0;p<c.length;p++){var b=c[p],g=r===i;"BR"===b.tagName||(b!==d||g||(v=!0),v&&f.push(b),b===l&&(v=!1))}s===u&&(1<u||0===s)||(h.selection={nodes:f.length?f:[d],start:s,end:u,value:t.toString()},w(e))}}function k(e){if(!p.clipboard)return e.preventDefault()}function x(e){e.preventDefault();var t=window.getSelection();if(p.clipboard&&t.rangeCount){for(var n=e.clipboardData.getData("text").split("\n"),r=0;r<n.length;r++){var a=document.createElement("div");a.innerText=n[r],t.getRangeAt(0).insertNode(a)}L()}}function w(e){for(var t=e.target,n=h.buttons,r=0;r<n.length;r++){var a=n[r];t.textContent?(a.classList.remove("disabled"),a.addEventListener("click",i)):(a.classList.add("disabled"),a.removeEventListener("click",i))}}function E(e){e.preventDefault()}function L(e){void 0===e&&(e=h.content),v.value=e.innerText}function $(e,t,n,r){void 0===e&&(e=""),void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r="");var a=e.split(""),i=n-t;return a.splice(t,i,r),a.join("")}function y(e){switch(e){case"Heading":return C(e);case"Bold":return A(e);case"Italic":return B(e);case"Blockquote":return M(e);case"Ordered-List":return D(e);case"Unordered-List":return N(e);case"Code":return O(e);case"Horizontal-Rule":return R();case"Link":return T();case"Image":return q()}}function C(e){return"# "+e}function A(e){return"**"+(e||" ")+"**"}function B(e){return"*"+(e||" ")+"*"}function M(e){return"> "+e}function D(e,t){return void 0===t&&(t=1),t+". "+e}function N(e){return"- "+e}function O(e){return"`"+(e||" ")+"`"}function R(e){return e||"---"}function T(e){return"["+(e||"title")+"](https://www.example.com)"}function q(e){return"!["+(e||"alt text")+"](image.jpg)"}return function(e){if(null==(e=p=Object.assign(t,p))||!e.options.length)throw new Error("Failed to initialize (missing settings)");v.form.addEventListener("reset",function(){h.content.textContent=""}),function(){var e,t=null==(e=p)?void 0:e.options.length,n=document.createElement("div");n.classList.add("textmarked");var r=v.getBoundingClientRect(),a=Math.round(r.height),i=Math.round(r.width);n.style.width=i+"px";var o=document.createElement("ul");o.classList.add("options"),o.setAttribute("aria-label","Markdown options"),o.setAttribute("role","menu");for(var s=Math.round((i-2*t)/t),u=0;u<t;u++){var d,l=p.options[u],c=document.createElement("li");c.classList.add("icon","disabled",l),c.setAttribute("aria-label",l),c.setAttribute("data-id",l),c.setAttribute("role","button"),c.setAttribute("tabindex",u+1),c.setAttribute("title",null!=(d=p)&&d.showExample?y(l):l),c.style.height=s+"px",c.style.width=s+"px",c.addEventListener("mousedown",E),o.appendChild(c),h.buttons.push(c)}n.appendChild(o);var f=document.createElement("div");f.classList.add("content"),f.setAttribute("contenteditable","true"),f.setAttribute("aria-label","Content editor"),f.setAttribute("role","textbox"),f.setAttribute("tabindex",t+1),f.innerText=v.value;f.style.minHeight=a-12+"px",f.style.minWidth=i-12+"px",f.addEventListener("focus",w),f.addEventListener("keydown",b),f.addEventListener("keyup",g),f.addEventListener("mouseup",m),f.addEventListener("copy",k),f.addEventListener("cut",k),f.addEventListener("paste",x),h.content=f,n.appendChild(f),v.parentNode.insertBefore(n,v),v.style.position="absolute",v.style.visibility="hidden"}()}(),e.focus=function(){h.content.focus()},e.markup=function(){return function(e){void 0===e&&(e="");for(var a=e.split(/\n/),t=[],i=!1,n=function(r){function n(e,t){t="<li>"+t+"</li>";var n=/^\s?(?:-|\d\.){1}\s(.*)$/.test(a[r+1]);return!1===i&&n&&(t="<"+e+">"+t,i=!0),!0!==i||n||(t=t+"</"+e+">",i=!1),t}var e=a[r];t.push(e.replace(/^#\s(.*)$/g,"<h1>$1</h1>").replace(/\*\*(.*)\*\*/g,"<strong>$1</strong>").replace(/\*(.*)\*/g,"<em>$1</em>").replace(/^>\s(.*)$/g,"<blockquote>$1</blockquote>").replace(/`(.*)`/g,"<code>$1</code>").replace(/^---$/g,"<hr>").replace(/!\[([^()]+)\]\(([^()]+)\)/g,'<img src="$2" alt="$1">').replace(/\[([^()]+)\]\(([^()]+)\)/g,'<a href="$2">$1</a>').replace(/^\s?\d+\.\s(.*)$/,function(e,t){return n("ol",t)}).replace(/^\s?-\s(.*)$/,function(e,t){return n("ul",t)}))},r=0;r<a.length;r++)n(r);return t.join("")}(v.value)},e}window.textMarked=function(e,t){return new TextMarked(e,t)},"undefined"!=typeof module&&module.exports&&(module.exports=TextMarked);