"use strict";function TextMarked(v,f){void 0===f&&(f={});var p=this,t={allowKeys:"a-z0-9\\s,.?!$%&()\\[\\]\"'-_#*`>",allowEnter:!1,clipboard:!1};function b(e){var t,n,a=null==(t=f)?void 0:t.allowKeys,i=e.key,r=e.target;return new RegExp("^["+a+"]{1}$","i").test(i)||"Backspace"===i||"Enter"===i&&null!=(n=f)&&n.allowEnter?w(r):e.preventDefault()}function h(e){var t=e.target;m(e),w(t)}function g(e){var t=p.selection;if(!t)return e.preventDefault();for(var n=t.node,a=t.start,i=t.end,r=t.value,o=e.target,d=n.length,l=1,s=0;s<d;s++){var c=n[s],u=void 0;if(1<d){switch(o.title){case"Blockquote":u=L(c.data);break;case"Ordered-List":u=y(c.data,l++);break;case"Unordered-List":u=C(c.data);break;default:u=c.data}c.textContent=u}else{switch(o.title){case"Heading":u="# "+r;break;case"Bold":u="**"+(r||" ")+"**";break;case"Italic":u="_"+(r||" ")+"_";break;case"Blockquote":u=L(r);break;case"Ordered-List":u=y(r);break;case"Unordered-List":u=C(r);break;case"Code":u="`"+(r||" ")+"`";break;case"Horizontal-Rule":u="---";break;case"Link":u="["+(r||"title")+"](https://www.example.com)";break;case"Image":u="!["+(r||"alt text")+"](image.jpg)"}a<i?c.textContent=E(c.textContent,a,i,u):0<i?c.after(u):c.textContent=u}}w(),p.selection=null}function m(e){var t=window.getSelection(),n=t.focusNode,a=t.focusOffset,i=t.anchorNode,r=t.anchorOffset;if(function(e){return e&&(e.contenteditable||e.parentNode.contenteditable)}(n))return e.preventDefault();for(var o=p.content.childNodes,d=[],l=!1,s=0;s<o.length;s++){var c=o[s],u="DIV"===c.tagName?c.firstChild:c;u===n&&(l=!0),("BR"!==u.tagName&&l||"BR"===u.tagName&&!l&&a===s+1)&&d.push(u),u===i&&(l=!1)}p.selection={node:d.length?d:[n],start:r<a?r:a,end:a<r?r:a,value:t.toString()}}function x(e){if(!f.clipboard)return e.preventDefault()}function k(e){e.preventDefault();var t=window.getSelection();if(f.clipboard&&t.rangeCount){for(var n=e.clipboardData.getData("text").split("\n"),a=0;a<n.length;a++){var i=document.createElement("div");i.innerText=n[a],t.getRangeAt(0).insertNode(i)}w()}}function w(e){void 0===e&&(e=p.content);for(var t=e.childNodes,n=0;n<t.length;n++){var a=t[n];if("DIV"===a.tagName){var i=a.firstChild,r=a.lastChild;a.replaceWith(i),r&&"BR"!==r.tagName&&r.after(document.createElement("br"))}}v.value=e.innerText}function E(e,t,n,a){void 0===e&&(e=""),void 0===t&&(t=0),void 0===n&&(n=0),void 0===a&&(a="");var i=e.split(""),r=n-t;return i.splice(t,r,a),i.join("")}function L(e){return"> "+e}function y(e,t){return void 0===t&&(t=1),t+". "+e}function C(e){return"- "+e}!function(e){if(null==(e=f=Object.assign(t,f))||!e.options.length)throw new Error("Failed to initialize (missing settings)");v.form.addEventListener("reset",function(){p.content.textContent=""}),function(){var e,t=null==(e=f)?void 0:e.options.length,n=document.createElement("div");n.classList.add("textmarked");var a=v.getBoundingClientRect(),i=Math.round(a.height),r=Math.round(a.width);n.style.width=r+"px";var o=document.createElement("ul");o.classList.add("options"),o.setAttribute("aria-label","Markdown options"),o.setAttribute("role","menu");for(var d=Math.round((r-2*t)/t),l=0;l<t;l++){var s=f.options[l],c=document.createElement("li");c.classList.add("icon"),c.classList.add(s),c.setAttribute("aria-label",s),c.setAttribute("role","button"),c.setAttribute("tabindex",l+1),c.setAttribute("title",s),c.style.height=d+"px",c.style.width=d+"px",c.addEventListener("click",g),o.appendChild(c)}n.appendChild(o);var u=document.createElement("div");u.classList.add("content"),u.setAttribute("contenteditable","true"),u.setAttribute("aria-label","Content editor"),u.setAttribute("role","textbox"),u.setAttribute("tabindex",t+1),u.innerText=v.value;u.style.minHeight=i-12+"px",u.style.minWidth=r-12+"px",u.addEventListener("keydown",b),u.addEventListener("keyup",h),u.addEventListener("mouseup",m),u.addEventListener("mouseout",m),u.addEventListener("copy",x),u.addEventListener("cut",x),u.addEventListener("paste",k),p.content=u,n.appendChild(u),v.parentNode.insertBefore(n,v),v.style.position="absolute",v.style.visibility="hidden"}()}()}window.textMarked=function(e,t){return new TextMarked(e,t)},"undefined"!=typeof module&&module.exports&&(module.exports=TextMarked);