"use strict";function TextMarked(v,p){void 0===p&&(p={});var b=this,t={allowKeys:"a-z0-9\\s,.?!$%&()\\[\\]\"'-_#*`>",allowEnter:!1,clipboard:!1,showExample:!1};function h(e){var t,n,r=null==(t=p)?void 0:t.allowKeys,a=e.key,i=e.target;return new RegExp("^["+r+"]{1}$","i").test(a)||"Backspace"===a||"Enter"===a&&null!=(n=p)&&n.allowEnter?E(i):e.preventDefault()}function m(e){var t=e.target;x(e),E(t)}function g(e){var t=b.selection;if(!t)return e.preventDefault();for(var n=t.node,r=t.start,a=t.end,i=t.value,o=e.target,d=n.length,s=n[0],l=n[d-1],u=!1,c=1,f=0;f<d;f++){var v=n[f],p=void 0;if(1<d){switch(o.dataset.id){case"Blockquote":p=B(v.data),u=!0;break;case"Ordered-List":p=D(v.data,c++),u=!0;break;case"Unordered-List":p=M(v.data),u=!0;break;default:p=v.data}v.textContent=p}else{switch(o.dataset.id){case"Heading":p=y(i);break;case"Bold":p=A(i);break;case"Italic":p=N(i);break;case"Blockquote":p=B(i);break;case"Ordered-List":p=D(i);break;case"Unordered-List":p=M(i);break;case"Code":p=R(i);break;case"Horizontal-Rule":p=I(i),u=!0;break;case"Link":p=O(i);break;case"Image":p=T(i)}r<a?v.textContent=L(v.textContent,r,a,p):0<a?v.after(p):v.textContent=p}}u&&(s.before(document.createElement("br")),l.after(document.createElement("br"))),E(),b.selection=null}function x(e){var t=window.getSelection(),n=t.focusNode,r=t.focusOffset,a=t.anchorNode,i=t.anchorOffset;if(function(e){return e&&(e.contenteditable||e.parentNode.contenteditable)}(n))return e.preventDefault();for(var o=b.content.childNodes,d=[],s=!1,l=0;l<o.length;l++){var u=o[l],c="DIV"===u.tagName?u.firstChild:u;c===n&&(s=!0),("BR"!==c.tagName&&s||"BR"===c.tagName&&!s&&r===l+1&&1!==l)&&d.push(c),c===a&&(s=!1)}b.selection={node:d.length?d:[n],start:i<r?i:r,end:r<i?i:r,value:t.toString()}}function k(e){if(!p.clipboard)return e.preventDefault()}function w(e){e.preventDefault();var t=window.getSelection();if(p.clipboard&&t.rangeCount){for(var n=e.clipboardData.getData("text").split("\n"),r=0;r<n.length;r++){var a=document.createElement("div");a.innerText=n[r],t.getRangeAt(0).insertNode(a)}E()}}function E(e){void 0===e&&(e=b.content);for(var t=e.childNodes,n=0;n<t.length;n++){var r=t[n];if("DIV"===r.tagName){var a=r.firstChild,i=r.lastChild;r.replaceWith(a),i&&"BR"!==i.tagName&&i.after(document.createElement("br"))}}v.value=e.innerText}function L(e,t,n,r){void 0===e&&(e=""),void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r="");var a=e.split(""),i=n-t;return a.splice(t,i,r),a.join("")}function C(e){switch(e){case"Heading":return y(e);case"Bold":return A(e);case"Italic":return N(e);case"Blockquote":return B(e);case"Ordered-List":return D(e);case"Unordered-List":return M(e);case"Code":return R(e);case"Horizontal-Rule":return I();case"Link":return O();case"Image":return T()}}function y(e){return"# "+e}function A(e){return"**"+(e||" ")+"**"}function N(e){return"_"+(e||" ")+"_"}function B(e){return"> "+e}function D(e,t){return void 0===t&&(t=1),t+". "+e}function M(e){return"- "+e}function R(e){return"`"+(e||" ")+"`"}function I(e){return e||"---"}function O(e){return"["+(e||"title")+"](https://www.example.com)"}function T(e){return"!["+(e||"alt text")+"](image.jpg)"}!function(e){if(null==(e=p=Object.assign(t,p))||!e.options.length)throw new Error("Failed to initialize (missing settings)");v.form.addEventListener("reset",function(){b.content.textContent=""}),function(){var e,t=null==(e=p)?void 0:e.options.length,n=document.createElement("div");n.classList.add("textmarked");var r=v.getBoundingClientRect(),a=Math.round(r.height),i=Math.round(r.width);n.style.width=i+"px";var o=document.createElement("ul");o.classList.add("options"),o.setAttribute("aria-label","Markdown options"),o.setAttribute("role","menu");for(var d=Math.round((i-2*t)/t),s=0;s<t;s++){var l,u=p.options[s],c=document.createElement("li");c.classList.add("icon"),c.classList.add(u),c.setAttribute("aria-label",u),c.setAttribute("data-id",u),c.setAttribute("role","button"),c.setAttribute("tabindex",s+1),c.setAttribute("title",null!=(l=p)&&l.showExample?C(u):u),c.style.height=d+"px",c.style.width=d+"px",c.addEventListener("click",g),o.appendChild(c)}n.appendChild(o);var f=document.createElement("div");f.classList.add("content"),f.setAttribute("contenteditable","true"),f.setAttribute("aria-label","Content editor"),f.setAttribute("role","textbox"),f.setAttribute("tabindex",t+1),f.innerText=v.value;f.style.minHeight=a-12+"px",f.style.minWidth=i-12+"px",f.addEventListener("keydown",h),f.addEventListener("keyup",m),f.addEventListener("mouseup",x),f.addEventListener("mouseout",x),f.addEventListener("copy",k),f.addEventListener("cut",k),f.addEventListener("paste",w),b.content=f,n.appendChild(f),v.parentNode.insertBefore(n,v),v.style.position="absolute",v.style.visibility="hidden"}()}()}window.textMarked=function(e,t){return new TextMarked(e,t)},"undefined"!=typeof module&&module.exports&&(module.exports=TextMarked);