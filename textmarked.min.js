"use strict";function TextMarked(v,b){void 0===b&&(b={});var t={allowKeys:"a-z0-9\\s,.?!$%&()\\[\\]\"'-_#*`>",allowEnter:!1,clipboard:!1,showExample:!1},m={buttons:[],content:null,selection:null};function p(e){var t,n,r=null==(t=b)?void 0:t.allowKeys,a=e.key,i=e.target;return new RegExp("^["+r+"]{1}$","i").test(a)||"Backspace"===a||"Enter"===a&&null!=(n=b)&&n.allowEnter?L(i):e.preventDefault()}function h(e){var t=e.target;w(e),g(e),L(t)}function i(e){var t=e.target,n=m.selection;if(!n)return e.preventDefault();for(var r=n.nodes,a=n.start,i=n.end,o=n.value,s=r.length,d=r[0],u=r[s-1],l=!1,c=1,f=0;f<s;f++){var v=r[f],b=void 0;if(1<s){switch(t.dataset.id){case"Blockquote":b=D(v.data),l=!0;break;case"Ordered-List":b=N(v.data,c++),l=!0;break;case"Unordered-List":b=O(v.data),l=!0;break;default:b=v.data}v.textContent=b}else{switch(t.dataset.id){case"Heading":b=A(o);break;case"Bold":b=B(o);break;case"Italic":b=M(o);break;case"Blockquote":b=D(o);break;case"Ordered-List":b=N(o);break;case"Unordered-List":b=O(o);break;case"Code":b=R(o);break;case"Horizontal-Rule":b=T(o),l=!0;break;case"Link":b=H(o);break;case"Image":b=z(o)}a<i?v.textContent=y(v.textContent,a,i,b):0<i?v.after(b):v.textContent=b}}l&&(d.before(document.createElement("br")),u.after(document.createElement("br"))),L(),m.selection=null}function g(e){var t=window.getSelection(),n=t.focusNode,r=t.focusOffset,a=t.anchorNode,i=t.anchorOffset,o=i<r,s=o?i:r,d=o?r:i,u=o?a:n,l=o?n:a;if(!function(e){return e&&e.contentEditable}(u)){for(var c=m.content.childNodes,f=[],v=!1,b=0;b<c.length;b++){var p=c[b],h=r===i;"BR"===p.tagName||(p!==u||h||(v=!0),v&&f.push(p),p===l&&(v=!1))}s===d&&(1<d||0===s)||(m.selection={nodes:f.length?f:[u],start:s,end:d,value:t.toString()},w(e))}}function x(e){if(!b.clipboard)return e.preventDefault()}function k(e){e.preventDefault();var t=window.getSelection();if(b.clipboard&&t.rangeCount){for(var n=e.clipboardData.getData("text").split("\n"),r=0;r<n.length;r++){var a=document.createElement("div");a.innerText=n[r],t.getRangeAt(0).insertNode(a)}L()}}function w(e){for(var t=e.target,n=m.buttons,r=0;r<n.length;r++){var a=n[r];t.textContent?(a.classList.remove("disabled"),a.addEventListener("click",i)):(a.classList.add("disabled"),a.removeEventListener("click",i))}}function E(e){e.preventDefault()}function L(e){void 0===e&&(e=m.content),v.value=e.innerText}function y(e,t,n,r){void 0===e&&(e=""),void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r="");var a=e.split(""),i=n-t;return a.splice(t,i,r),a.join("")}function C(e){switch(e){case"Heading":return A(e);case"Bold":return B(e);case"Italic":return M(e);case"Blockquote":return D(e);case"Ordered-List":return N(e);case"Unordered-List":return O(e);case"Code":return R(e);case"Horizontal-Rule":return T();case"Link":return H();case"Image":return z()}}function A(e){return"# "+e}function B(e){return"**"+(e||" ")+"**"}function M(e){return"_"+(e||" ")+"_"}function D(e){return"> "+e}function N(e,t){return void 0===t&&(t=1),t+". "+e}function O(e){return"- "+e}function R(e){return"`"+(e||" ")+"`"}function T(e){return e||"---"}function H(e){return"["+(e||"title")+"](https://www.example.com)"}function z(e){return"!["+(e||"alt text")+"](image.jpg)"}return function(e){if(null==(e=b=Object.assign(t,b))||!e.options.length)throw new Error("Failed to initialize (missing settings)");v.form.addEventListener("reset",function(){m.content.textContent=""}),function(){var e,t=null==(e=b)?void 0:e.options.length,n=document.createElement("div");n.classList.add("textmarked");var r=v.getBoundingClientRect(),a=Math.round(r.height),i=Math.round(r.width);n.style.width=i+"px";var o=document.createElement("ul");o.classList.add("options"),o.setAttribute("aria-label","Markdown options"),o.setAttribute("role","menu");for(var s=Math.round((i-2*t)/t),d=0;d<t;d++){var u,l=b.options[d],c=document.createElement("li");c.classList.add("icon","disabled",l),c.setAttribute("aria-label",l),c.setAttribute("data-id",l),c.setAttribute("role","button"),c.setAttribute("tabindex",d+1),c.setAttribute("title",null!=(u=b)&&u.showExample?C(l):l),c.style.height=s+"px",c.style.width=s+"px",c.addEventListener("mousedown",E),o.appendChild(c),m.buttons.push(c)}n.appendChild(o);var f=document.createElement("div");f.classList.add("content"),f.setAttribute("contenteditable","true"),f.setAttribute("aria-label","Content editor"),f.setAttribute("role","textbox"),f.setAttribute("tabindex",t+1),f.innerText=v.value;f.style.minHeight=a-12+"px",f.style.minWidth=i-12+"px",f.addEventListener("focus",w),f.addEventListener("keydown",p),f.addEventListener("keyup",h),f.addEventListener("mouseup",g),f.addEventListener("copy",x),f.addEventListener("cut",x),f.addEventListener("paste",k),m.content=f,n.appendChild(f),v.parentNode.insertBefore(n,v),v.style.position="absolute",v.style.visibility="hidden"}()}(),this.focus=function(){m.content.focus()},this}window.textMarked=function(e,t){return new TextMarked(e,t)},"undefined"!=typeof module&&module.exports&&(module.exports=TextMarked);