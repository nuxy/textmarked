"use strict";function TextMarked(v,f){void 0===f&&(f={});var p=this,t={allowKeys:"a-z0-9\\s,.?!$%&()\\[\\]\"'-_#*`>",allowEnter:!1,clipboard:!1};function b(e){var t,n,a=null==(t=f)?void 0:t.allowKeys,i=e.key,r=e.target;if(!(new RegExp("^["+a+"]{1}$","i").test(i)||"Backspace"===i||"Enter"===i&&null!=(n=f)&&n.allowEnter))return e.preventDefault();v.value=r.innerText}function h(e){var t=e.target;v.value=t.innerText,t.click()}function g(e){var t=p.selection;if(t){for(var n=t.node,a=t.start,i=t.end,r=t.value,o=e.target,d=1,l=0;l<n.length;l++){var s=n[l],c=void 0;if(1<l){switch(o.title){case"Blockquote":c=w(s.data);break;case"Ordered-List":c=E(s.data,d++);break;case"Unordered-List":c=L(s.data);break;default:c=s.data}s.textContent=c}else{switch(o.title){case"Heading":c="# "+r;break;case"Bold":c="**"+(r||" ")+"**";break;case"Italic":c="_"+(r||" ")+"_";break;case"Blockquote":c=w(r);break;case"Ordered-List":c=E(r);break;case"Unordered-List":c=L(r);break;case"Code":c="`"+(r||" ")+"`";break;case"Horizontal-Rule":c="---";break;case"Link":c="["+(r||"title")+"](https://www.example.com)";break;case"Image":c="!["+(r||"alt text")+"](image.jpg)"}s.textContent=u(s.textContent,a,i,c)}}v.value=p.content.innerText,p.selection=null}}function x(){for(var e=window.getSelection(),t=e.focusNode,n=e.focusOffset,a=e.anchorNode,i=e.anchorOffset,r=p.content.childNodes,o=[],d=!1,l=0;l<r.length;l++){var s=r[l],c="DIV"===s.tagName?s.firstChild:s;c===t&&(d=!0),"BR"!==c.tagName&&d&&o.push(c),c===a&&(d=!1)}p.selection={node:o.length?o:[t],start:i<n?i:n,end:n<i?i:n,value:e.toString()}}function k(e){if(!f.clipboard)return e.preventDefault()}function m(e){e.preventDefault();var t=window.getSelection();if(f.clipboard&&t.rangeCount){for(var n=e.clipboardData.getData("text").split("\n"),a=0;a<n.length;a++){var i=document.createElement("DIV");i.innerText=n[a],t.getRangeAt(0).insertNode(i)}v.value=p.content.innerText}}function u(e,t,n,a){void 0===e&&(e=""),void 0===t&&(t=0),void 0===n&&(n=0),void 0===a&&(a="");var i=e.split(""),r=n-t;return i.splice(t,r,a),i.join("")}function w(e){return"> "+e}function E(e,t){return void 0===t&&(t=1),t+". "+e}function L(e){return"- "+e}!function(e){if(null==(e=f=Object.assign(t,f))||!e.options.length)throw new Error("Failed to initialize (missing settings)");v.form.addEventListener("reset",function(){p.content.textContent=""}),function(){var e,t=null==(e=f)?void 0:e.options.length,n=document.createElement("div");n.classList.add("textmarked");var a=v.getBoundingClientRect(),i=Math.round(a.height),r=Math.round(a.width);n.style.width=r+"px";var o=document.createElement("ul");o.classList.add("options"),o.setAttribute("aria-label","Markdown options"),o.setAttribute("role","menu");for(var d=Math.round((r-2*t)/t),l=0;l<t;l++){var s=f.options[l],c=document.createElement("li");c.classList.add("icon"),c.classList.add(s),c.setAttribute("aria-label",s),c.setAttribute("role","button"),c.setAttribute("tabindex",l+1),c.setAttribute("title",s),c.style.height=d+"px",c.style.width=d+"px",c.addEventListener("click",g),o.appendChild(c)}n.appendChild(o);var u=document.createElement("div");u.classList.add("content"),u.setAttribute("contenteditable","true"),u.setAttribute("aria-label","Content editor"),u.setAttribute("role","textbox"),u.setAttribute("tabindex",t+1),u.innerText=v.value;u.style.minHeight=i-12+"px",u.style.minWidth=r-12+"px",u.addEventListener("keydown",b),u.addEventListener("keyup",h),u.addEventListener("click",x),u.addEventListener("copy",k),u.addEventListener("cut",k),u.addEventListener("paste",m),p.content=u,n.appendChild(u),v.parentNode.insertBefore(n,v),v.style.position="absolute",v.style.visibility="hidden"}()}()}window.textMarked=function(e,t){return new TextMarked(e,t)},"undefined"!=typeof module&&module.exports&&(module.exports=TextMarked);